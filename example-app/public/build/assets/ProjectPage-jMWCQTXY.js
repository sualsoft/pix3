import{r as x,o as F,c as g,e as k,d as e,n as N,t as m,f as b,v,H as U,z as S,F as P,q as V,b as p,j as C,k as $,l as E,u as D,m as A}from"./app-CApJRcw1.js";import{_ as I}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-B1qxWliu.js";const M={class:"space-y-6"},O={class:"overflow-hidden rounded-2xl border border-gray-100 bg-white shadow-xl"},q={class:"bg-gradient-to-r from-indigo-600 to-purple-700 p-6 text-white"},L={class:"mt-1 text-indigo-100"},z={class:"p-6 md:p-8"},B={class:"space-y-6"},R={class:"space-y-3"},X={class:"flex justify-end"},K=["disabled"],G={class:"overflow-hidden rounded-2xl border border-gray-100 bg-white shadow-xl"},Q={class:"p-6 md:p-8"},W={key:0,class:"space-y-4"},H={class:"flex justify-between"},J={class:"font-bold text-gray-900"},Y={class:"text-sm text-gray-600 capitalize"},Z={class:"mt-1 text-xs text-gray-500"},ee={class:"text-right"},te={key:0,class:"inline-flex items-center rounded-full bg-blue-100 px-2.5 py-0.5 text-xs font-medium text-blue-800"},le=["onClick"],oe={key:0,class:"mt-3"},se=["src","alt"],re={key:1,class:"py-8 text-center text-gray-500"},ae={__name:"FileManagement",props:{projectId:{type:Number,required:!0},projectName:{type:String,default:""}},emits:["filesUpdated"],setup(w,{emit:h}){const i=w,d=h,l=x({name:"",type:"video",date:"",badge:"",youtube_id:"",thumbnail_file:null,download_file:null,external_link:""}),y=x([]),r=x(""),f=x(!1),a=async()=>{try{const t=await(await fetch(`/api/user-project/${i.projectId}`)).json();t&&t.files&&(y.value=t.files),d("filesUpdated",y.value)}catch(n){console.error("Error loading files",n),r.value="❌ Error loading files: "+n.message}},s=n=>{l.value.thumbnail_file=n.target.files[0]},u=n=>{l.value.download_file=n.target.files[0]},j=async()=>{f.value=!0,r.value="";try{const n=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),t=new FormData;t.append("project_id",i.projectId),t.append("name",l.value.name),t.append("type",l.value.type),t.append("date",l.value.date),t.append("badge",l.value.badge),t.append("youtube_id",l.value.youtube_id),l.value.thumbnail_file&&t.append("thumbnail_file",l.value.thumbnail_file),l.value.download_file&&t.append("download_file",l.value.download_file),l.value.external_link&&t.append("external_link",l.value.external_link);const o=await fetch("/api/user-project/file",{method:"POST",headers:{"X-CSRF-TOKEN":n},body:t});let c={};try{c=await o.json()}catch{c.message=await o.text()}if(o.ok)r.value="✅ File added successfully!",l.value={name:"",type:"video",date:"",badge:"",youtube_id:"",thumbnail_file:null,download_file:null,external_link:""},a();else if(c.errors){const _=Object.values(c.errors).flat().join(", ");r.value="❌ Validation Error: "+_}else r.value="❌ Error: "+(c.message||"Failed to add file")}catch(n){r.value="❌ Network error: "+n.message,console.error("Add file error",n)}finally{f.value=!1}},T=async n=>{if(confirm("Are you sure you want to delete this file?")){f.value=!0,r.value="";try{const t=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),o=await fetch(`/api/user-project/file/${n}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":t}});let c={};try{c=await o.json()}catch{c.message=await o.text()}o.ok?(r.value="✅ File deleted successfully!",a()):r.value="❌ Error: "+(c.message||"Failed to delete file")}catch(t){r.value="❌ Network error: "+t.message,console.error("Delete error",t)}finally{f.value=!1}}};return F(()=>{a()}),(n,t)=>(p(),g("div",M,[r.value?(p(),g("div",{key:0,class:N(["rounded-lg p-4",{"bg-green-100 text-green-800":r.value.includes("✅"),"bg-red-100 text-red-800":r.value.includes("❌")}])},m(r.value),3)):k("",!0),e("div",O,[e("div",q,[t[6]||(t[6]=e("h2",{class:"text-2xl font-bold"},"Ajouter un Fichier",-1)),e("p",L," Add new content to "+m(w.projectName),1)]),e("div",z,[e("div",B,[e("div",null,[t[7]||(t[7]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700"},"Nom du Fichier *",-1)),b(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>l.value.name=o),type:"text",class:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 focus:ring-2 focus:ring-indigo-500 focus:outline-none",placeholder:"ex: Timelapse Semaine 4",required:""},null,512),[[v,l.value.name]])]),e("div",null,[t[8]||(t[8]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700"},"Date *",-1)),b(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>l.value.date=o),type:"date",class:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 focus:ring-2 focus:ring-indigo-500 focus:outline-none",required:""},null,512),[[v,l.value.date]])]),e("div",null,[t[10]||(t[10]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700"},"Type *",-1)),b(e("select",{"onUpdate:modelValue":t[2]||(t[2]=o=>l.value.type=o),class:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 focus:ring-2 focus:ring-indigo-500 focus:outline-none"},[...t[9]||(t[9]=[e("option",{value:"video"},"Vidéo",-1),e("option",{value:"image"},"Image",-1),e("option",{value:"document"},"Document",-1)])],512),[[U,l.value.type]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700"},"Source du téléchargement",-1)),e("div",R,[e("div",null,[t[11]||(t[11]=e("label",{class:"mb-1 block text-xs text-gray-500"},"Téléverser un fichier",-1)),e("input",{type:"file",onChange:u,class:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 focus:ring-2 focus:ring-indigo-500 focus:outline-none"},null,32)]),t[13]||(t[13]=S('<div class="relative"><div class="absolute inset-0 flex items-center"><div class="w-full border-t border-gray-300"></div></div><div class="relative flex justify-center text-sm"><span class="bg-white px-2 text-gray-500">OU</span></div></div>',1)),e("div",null,[t[12]||(t[12]=e("label",{class:"mb-1 block text-xs text-gray-500"},"Lien Google Drive / Externe",-1)),b(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>l.value.external_link=o),type:"url",class:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 focus:ring-2 focus:ring-indigo-500 focus:outline-none",placeholder:"https://drive.google.com/file/..."},null,512),[[v,l.value.external_link]])])])]),e("div",null,[t[15]||(t[15]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700"},"ID YouTube (Pour l'aperçu)",-1)),b(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>l.value.youtube_id=o),type:"text",class:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 focus:ring-2 focus:ring-indigo-500 focus:outline-none",placeholder:"ex: dQw4w9WgXcQ"},null,512),[[v,l.value.youtube_id]]),t[16]||(t[16]=e("p",{class:"mt-1 text-xs text-gray-500"}," Laissez vide si vous ne voulez pas de lecture directe. ",-1))]),e("div",null,[t[17]||(t[17]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700"},"Miniature (Image)",-1)),e("input",{type:"file",accept:"image/*",onChange:s,class:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 focus:ring-2 focus:ring-indigo-500 focus:outline-none"},null,32)]),e("div",null,[t[18]||(t[18]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700"},"Badge",-1)),b(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>l.value.badge=o),type:"text",class:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 focus:ring-2 focus:ring-indigo-500 focus:outline-none",placeholder:"NEW"},null,512),[[v,l.value.badge]])]),e("div",X,[e("button",{onClick:j,disabled:f.value,class:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-700 disabled:opacity-50"},m(f.value?"Ajout en cours...":"Ajouter le Fichier"),9,K)])])])]),e("div",G,[t[20]||(t[20]=e("div",{class:"bg-gradient-to-r from-green-600 to-emerald-700 p-6 text-white"},[e("h2",{class:"text-2xl font-bold"},"Fichiers du Projet"),e("p",{class:"mt-1 text-green-100"},"Manage existing content")],-1)),e("div",Q,[y.value.length>0?(p(),g("div",W,[(p(!0),g(P,null,V(y.value,o=>(p(),g("div",{key:o.id,class:"rounded-lg border border-gray-200 p-4"},[e("div",H,[e("div",null,[e("h3",J,m(o.name),1),e("p",Y,m(o.type),1),e("p",Z,m(o.date),1)]),e("div",ee,[o.badge?(p(),g("span",te,m(o.badge),1)):k("",!0),e("button",{onClick:c=>T(o.id),class:"ml-4 text-sm text-red-600 hover:text-red-800"}," Supprimer ",8,le)])]),o.thumbnail?(p(),g("div",oe,[e("img",{src:o.thumbnail,alt:o.name,class:"h-20 w-20 rounded object-cover"},null,8,se)])):k("",!0)]))),128))])):(p(),g("div",re,[...t[19]||(t[19]=[e("p",null,"Aucun fichier trouvé.",-1),e("p",{class:"mt-2 text-sm"}," Ajoutez votre premier fichier en utilisant le formulaire ci-dessus. ",-1)])]))])])]))}},ne={class:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8"},ie={class:"mb-8 overflow-hidden rounded-2xl border border-gray-100 bg-white shadow-xl"},de={class:"p-6 md:p-8"},ue={class:"space-y-6"},ce=["value"],pe={class:"flex justify-end"},ge=["disabled"],be={__name:"ProjectPage",props:{projectId:{type:Number,required:!0},project:{type:Object,required:!0}},setup(w){const h=w,i=x(h.project),d=x(""),l=x(!1),y=async()=>{try{const s=await(await fetch(`/api/user-project/${h.projectId}`)).json();s&&(i.value=s)}catch(a){console.error("Error loading project",a),d.value="❌ Error loading project: "+a.message}},r=async()=>{l.value=!0,d.value="";try{const a=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),s=await fetch("/api/user-project/info",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":a},body:JSON.stringify({client_name:i.value.client_name,title:i.value.title})});let u={};try{u=await s.json()}catch{u.message=await s.text()}if(s.ok)d.value="✅ Project information updated successfully!";else if(u.errors){const j=Object.values(u.errors).flat().join(", ");d.value="❌ Validation Error: "+j}else d.value="❌ Error: "+(u.message||"Failed to update project")}catch(a){d.value="❌ Network error: "+a.message,console.error("Update error",a)}finally{l.value=!1}},f=a=>{i.value.files=a};return F(()=>{y()}),(a,s)=>(p(),C(I,null,{default:$(()=>[E(D(A),{title:i.value.title||"Project Page"},null,8,["title"]),e("div",ne,[s[7]||(s[7]=e("div",{class:"mb-8"},[e("h1",{class:"text-3xl font-bold text-gray-900"}," Gestion du Projet "),e("p",{class:"mt-2 text-gray-600"}," Manage your project content and files ")],-1)),d.value?(p(),g("div",{key:0,class:N(["mb-6 rounded-lg p-4",{"bg-green-100 text-green-800":d.value.includes("✅"),"bg-red-100 text-red-800":d.value.includes("❌")}])},m(d.value),3)):k("",!0),e("div",ie,[s[6]||(s[6]=e("div",{class:"bg-gradient-to-r from-indigo-600 to-purple-700 p-6 text-white"},[e("h2",{class:"text-2xl font-bold"},"Informations du Projet")],-1)),e("div",de,[e("div",ue,[e("div",null,[s[2]||(s[2]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700"},"Nom du Client",-1)),b(e("input",{"onUpdate:modelValue":s[0]||(s[0]=u=>i.value.client_name=u),type:"text",class:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 focus:ring-2 focus:ring-indigo-500 focus:outline-none",placeholder:"Enter client name"},null,512),[[v,i.value.client_name]])]),e("div",null,[s[3]||(s[3]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700"},"Titre du Projet",-1)),b(e("input",{"onUpdate:modelValue":s[1]||(s[1]=u=>i.value.title=u),type:"text",class:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 focus:ring-2 focus:ring-indigo-500 focus:outline-none",placeholder:"Enter project title"},null,512),[[v,i.value.title]])]),e("div",null,[s[4]||(s[4]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700"},"URL du Projet",-1)),e("input",{type:"text",value:`/user/${i.value.slug||"project-slug"}`,class:"w-full rounded-md border border-gray-300 bg-gray-50 px-3 py-2 text-gray-700 focus:ring-2 focus:ring-indigo-500 focus:outline-none",readonly:""},null,8,ce),s[5]||(s[5]=e("p",{class:"mt-1 text-xs text-gray-500"}," This is the public URL for your project page ",-1))]),e("div",pe,[e("button",{onClick:r,disabled:l.value,class:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-700 disabled:opacity-50"},m(l.value?"Enregistrement...":"Enregistrer les Modifications"),9,ge)])])])]),E(ae,{"project-id":w.projectId,"project-name":i.value.title,onFilesUpdated:f},null,8,["project-id","project-name"])])]),_:1}))}};export{be as default};
