import{r as c,o as k,j as A,k as C,l as U,d as e,u as E,m as N,c as n,e as S,b as l,n as T,t as i,f as g,F as v,q as x,H as _,v as y}from"./app-u3oTKOlE.js";import{_ as V}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-nmJaGcP0.js";const O={class:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8"},P={class:"overflow-hidden rounded-2xl border border-gray-100 bg-white shadow-xl"},F={class:"p-6 md:p-8"},R={class:"space-y-6"},D=["value"],M={class:"border-t border-gray-200 pt-6"},B=["value"],q={class:"mt-4"},$=["disabled"],J={class:"border-t border-gray-200 pt-6"},K={class:"space-y-4"},L={class:"mt-4"},X=["disabled"],z={class:"mt-8 overflow-hidden rounded-2xl border border-gray-100 bg-white shadow-xl"},H={class:"p-6 md:p-8"},G={key:0,class:"overflow-x-auto"},Q={class:"min-w-full divide-y divide-gray-200"},W={class:"divide-y divide-gray-200 bg-white"},Y={class:"px-6 py-4 text-sm font-medium whitespace-nowrap text-gray-900"},Z={class:"px-6 py-4 text-sm whitespace-nowrap text-gray-500"},I={key:1,class:"py-8 text-center text-gray-500"},re={__name:"ClientAssign",setup(ee){const f=c([]),b=c([]),a=c(""),d=c(!1),r=c({project_id:"",user_id:"",new_user_name:"",new_user_email:"",new_user_password:""}),p=c([]),w=async()=>{try{const s=await(await fetch("/api/user-projects")).json();f.value=s.projects||[];const u=await(await fetch("/api/users")).json();b.value=u.users||[]}catch(o){console.error("Error loading data",o),a.value="❌ Error loading data: "+o.message}},h=async()=>{d.value=!0,a.value="";try{const o=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),s=await fetch("/api/client-assign/assign-user",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":o},body:JSON.stringify(r.value)});let t={};try{t=await s.json()}catch{t.message=await s.text()}if(s.ok)a.value="✅ User assigned to project successfully!",r.value.user_id="",m(r.value.project_id);else if(t.errors){const u=Object.values(t.errors).flat().join(", ");a.value="❌ Validation Error: "+u}else a.value="❌ Error: "+(t.message||"Failed to assign user to project")}catch(o){a.value="❌ Network error: "+o.message,console.error("Assign error",o)}finally{d.value=!1}},j=async()=>{d.value=!0,a.value="";try{const o=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),s=await fetch("/api/client-assign/create-user",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":o},body:JSON.stringify(r.value)});let t={};try{t=await s.json()}catch{t.message=await s.text()}if(s.ok)a.value="✅ New user created and assigned to project successfully!",r.value.new_user_name="",r.value.new_user_email="",r.value.new_user_password="",w(),m(r.value.project_id);else if(t.errors){const u=Object.values(t.errors).flat().join(", ");a.value="❌ Validation Error: "+u}else a.value="❌ Error: "+(t.message||"Failed to create and assign user")}catch(o){a.value="❌ Network error: "+o.message,console.error("Create user error",o)}finally{d.value=!1}},m=async o=>{if(!o){p.value=[];return}try{const t=await(await fetch(`/api/client-assign/project/${o}/users`)).json();p.value=t.users||[]}catch(s){console.error("Error loading assigned users",s)}};return k(()=>{w()}),(o,s)=>(l(),A(V,null,{default:C(()=>[U(E(N),{title:"Client Assignment"}),e("div",O,[s[21]||(s[21]=e("div",{class:"mb-8"},[e("h1",{class:"text-3xl font-bold text-gray-900"}," Client Assignment "),e("p",{class:"mt-2 text-gray-600"}," Assign users to projects and manage client access ")],-1)),a.value?(l(),n("div",{key:0,class:T(["mb-6 rounded-lg p-4",{"bg-green-100 text-green-800":a.value.includes("✅"),"bg-red-100 text-red-800":a.value.includes("❌")}])},i(a.value),3)):S("",!0),e("div",P,[s[16]||(s[16]=e("div",{class:"bg-gradient-to-r from-indigo-600 to-purple-700 p-6 text-white"},[e("h2",{class:"text-2xl font-bold"}," Assign Clients to Projects "),e("p",{class:"mt-1 text-indigo-100"}," Manage which users have access to which projects ")],-1)),e("div",F,[e("div",R,[e("div",null,[s[7]||(s[7]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700"},"Select Project *",-1)),g(e("select",{"onUpdate:modelValue":s[0]||(s[0]=t=>r.value.project_id=t),onChange:s[1]||(s[1]=t=>m(r.value.project_id)),class:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 focus:ring-2 focus:ring-indigo-500 focus:outline-none"},[s[6]||(s[6]=e("option",{value:""},"Choose a project",-1)),(l(!0),n(v,null,x(f.value,t=>(l(),n("option",{key:t.id,value:t.id},i(t.title)+" ("+i(t.client_name)+") ",9,D))),128))],544),[[_,r.value.project_id]])]),e("div",M,[s[10]||(s[10]=e("h3",{class:"mb-4 text-lg font-medium text-gray-900"}," Assign Existing User ",-1)),e("div",null,[s[9]||(s[9]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700"},"Select User",-1)),g(e("select",{"onUpdate:modelValue":s[2]||(s[2]=t=>r.value.user_id=t),class:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 focus:ring-2 focus:ring-indigo-500 focus:outline-none"},[s[8]||(s[8]=e("option",{value:""},"Choose a user",-1)),(l(!0),n(v,null,x(b.value,t=>(l(),n("option",{key:t.id,value:t.id},i(t.name)+" ("+i(t.email)+") ",9,B))),128))],512),[[_,r.value.user_id]])]),e("div",q,[e("button",{onClick:h,disabled:d.value||!r.value.project_id||!r.value.user_id,class:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-700 disabled:opacity-50"},i(d.value?"Assigning...":"Assign User to Project"),9,$)])]),s[15]||(s[15]=e("div",{class:"relative"},[e("div",{class:"absolute inset-0 flex items-center"},[e("div",{class:"w-full border-t border-gray-300"})]),e("div",{class:"relative flex justify-center text-sm"},[e("span",{class:"bg-white px-2 text-gray-500"},"OR")])],-1)),e("div",J,[s[14]||(s[14]=e("h3",{class:"mb-4 text-lg font-medium text-gray-900"}," Create New User and Assign ",-1)),e("div",K,[e("div",null,[s[11]||(s[11]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700"},"User Name *",-1)),g(e("input",{"onUpdate:modelValue":s[3]||(s[3]=t=>r.value.new_user_name=t),type:"text",class:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 focus:ring-2 focus:ring-indigo-500 focus:outline-none",placeholder:"Enter user's full name"},null,512),[[y,r.value.new_user_name]])]),e("div",null,[s[12]||(s[12]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700"},"Email Address *",-1)),g(e("input",{"onUpdate:modelValue":s[4]||(s[4]=t=>r.value.new_user_email=t),type:"email",class:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 focus:ring-2 focus:ring-indigo-500 focus:outline-none",placeholder:"Enter user's email address"},null,512),[[y,r.value.new_user_email]])]),e("div",null,[s[13]||(s[13]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700"},"Password *",-1)),g(e("input",{"onUpdate:modelValue":s[5]||(s[5]=t=>r.value.new_user_password=t),type:"password",class:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 focus:ring-2 focus:ring-indigo-500 focus:outline-none",placeholder:"Enter a strong password"},null,512),[[y,r.value.new_user_password]])])]),e("div",L,[e("button",{onClick:j,disabled:d.value||!r.value.project_id||!r.value.new_user_name||!r.value.new_user_email||!r.value.new_user_password,class:"rounded-md bg-green-600 px-4 py-2 text-sm font-medium text-white hover:bg-green-700 disabled:opacity-50"},i(d.value?"Creating...":"Create User and Assign to Project"),9,X)])])])])]),e("div",z,[s[20]||(s[20]=e("div",{class:"bg-gradient-to-r from-green-600 to-emerald-700 p-6 text-white"},[e("h2",{class:"text-2xl font-bold"},"Assigned Users"),e("p",{class:"mt-1 text-green-100"}," Users assigned to projects ")],-1)),e("div",H,[p.value.length>0?(l(),n("div",G,[e("table",Q,[s[18]||(s[18]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase"}," User Name "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase"}," Email "),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase"}," Assigned Date ")])],-1)),e("tbody",W,[(l(!0),n(v,null,x(p.value,t=>(l(),n("tr",{key:t.id},[e("td",Y,i(t.name),1),e("td",Z,i(t.email),1),s[17]||(s[17]=e("td",{class:"px-6 py-4 text-sm whitespace-nowrap text-gray-500"}," Assigned ",-1))]))),128))])])])):(l(),n("div",I,[...s[19]||(s[19]=[e("p",null,"No users assigned to this project yet.",-1),e("p",{class:"mt-2 text-sm"}," Select a project and assign users above. ",-1)])]))])])])]),_:1}))}};export{re as default};
