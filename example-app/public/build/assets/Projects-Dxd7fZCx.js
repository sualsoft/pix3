import{r as b,o as F,j as O,k as L,d as t,g as h,w as q,c as f,e as w,f as c,v as g,t as m,b as p,n as $,B as M,F as A,q as D}from"./app-CApJRcw1.js";import{_ as B}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-B1qxWliu.js";const K={class:"min-h-screen w-full bg-gradient-to-br from-blue-50 to-indigo-100 p-4 md:p-8"},X={class:"mx-auto max-w-6xl"},J={class:"grid grid-cols-1 gap-8 lg:grid-cols-2"},z={class:"overflow-hidden rounded-2xl border border-gray-100 bg-white shadow-xl"},I={class:"space-y-6"},G={class:"mt-8 flex items-center justify-end gap-4"},H=["disabled"],Q={class:"overflow-hidden rounded-2xl border border-gray-100 bg-white shadow-xl"},W={class:"p-6 md:p-8"},Y={key:0,class:"mb-6 rounded-lg border border-yellow-200 bg-yellow-50 p-4"},Z={class:"space-y-4"},ee={class:"mt-1 text-xs text-gray-500"},te={class:"flex justify-end space-x-2"},le=["disabled"],se={key:1,class:"mb-6 rounded-lg border border-blue-200 bg-blue-50 p-4"},re={class:"space-y-4"},oe={class:"mt-1 text-xs text-gray-500"},ae={class:"flex items-center"},ne={class:"flex justify-end space-x-2"},ue=["disabled"],ie={key:2,class:"mb-6 rounded-lg border border-green-200 bg-green-50 p-4"},de={class:"space-y-4"},ce={class:"mt-1 text-xs text-gray-500"},ge={class:"flex justify-end space-x-2"},me=["disabled"],pe={key:3,class:"space-y-4"},be={class:"flex justify-between"},fe={class:"font-bold text-gray-900"},ve={class:"text-sm text-gray-600"},xe={class:"mt-1 text-xs text-gray-500"},ye=["href"],we={class:"flex flex-col justify-between text-right"},he={class:"inline-flex items-center rounded-full bg-blue-100 px-2.5 py-0.5 text-xs font-medium text-blue-800"},ke={class:"mt-2 flex space-x-2"},je=["href"],_e=["href"],Ce=["onClick"],Ee=["onClick"],Te=["onClick"],Pe=["onClick"],Ue={key:4,class:"text-center text-gray-500"},Fe={__name:"Projects",setup(Ne){const d=b({client_name:"",title:"",slug:""}),u=b({id:null,client_name:"",title:"",slug:""}),o=b({id:null,client_name:"",title:"",slug:"",reset_content:!1}),i=b({client_name:"",title:"",slug:"",template_page_id:null}),x=b([]),r=b(""),n=b(!1),y=b(!1),v=async()=>{try{const e=await(await fetch("/api/user-projects")).json();e.projects&&(x.value=e.projects)}catch(s){console.error("Error loading projects",s);try{const l=await(await fetch("/api/user-project")).json();l.project&&(x.value=[l.project])}catch(e){console.error("Fallback error",e)}}},C=async()=>{n.value=!0,r.value="";try{const s=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),e=await fetch("/api/user-project/create",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":s},body:JSON.stringify(d.value)});let l={};try{l=await e.json()}catch{l.message=await e.text()}if(e.ok)r.value="✅ Project created successfully!",d.value.client_name="",d.value.title="",d.value.slug="",v();else if(l.errors){const a=Object.values(l.errors).flat().join(", ");r.value="❌ Validation Error: "+a}else r.value="❌ Error: "+(l.message||"Failed to create project")}catch(s){r.value="❌ Network error: "+s.message,console.error("Create error",s)}finally{n.value=!1}},E=()=>{d.value.title&&(d.value.slug=d.value.title.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,""))},T=s=>{y.value=!0,u.value.id=s.id,u.value.client_name=s.client_name,u.value.title=s.title,u.value.slug=s.slug},k=()=>{y.value=!1,u.value.id=null,u.value.client_name="",u.value.title="",u.value.slug=""},P=s=>{y.value=!1,o.value.id=s.id,o.value.client_name=s.client_name,o.value.title=s.title,o.value.slug=s.slug,o.value.reset_content=!1},j=()=>{o.value.id=null,o.value.client_name="",o.value.title="",o.value.slug="",o.value.reset_content=!1},U=s=>{i.value.template_page_id=s,i.value.client_name="",i.value.title="",i.value.slug=""},_=()=>{i.value.template_page_id=null,i.value.client_name="",i.value.title="",i.value.slug=""},N=async()=>{n.value=!0,r.value="";try{const s=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),e=await fetch(`/api/user-project/${u.value.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":s},body:JSON.stringify(u.value)});let l={};try{l=await e.json()}catch{l.message=await e.text()}if(e.ok)r.value="✅ Project updated successfully!",k(),v();else if(l.errors){const a=Object.values(l.errors).flat().join(", ");r.value="❌ Validation Error: "+a}else r.value="❌ Error: "+(l.message||"Failed to update project")}catch(s){r.value="❌ Network error: "+s.message,console.error("Update error",s)}finally{n.value=!1}},R=async s=>{if(confirm("Are you sure you want to delete this project? This will delete all associated files.")){n.value=!0,r.value="";try{const e=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),l=await fetch(`/api/user-project/${s}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":e}});let a={};try{a=await l.json()}catch{a.message=await l.text()}l.ok?(r.value="✅ Project deleted successfully!",v()):r.value="❌ Error: "+(a.message||"Failed to delete project")}catch(e){r.value="❌ Network error: "+e.message,console.error("Delete error",e)}finally{n.value=!1}}},S=async()=>{n.value=!0,r.value="";try{const s=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),e=await fetch(`/api/user-project/${o.value.id}/refresh`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":s},body:JSON.stringify(o.value)});let l={};try{l=await e.json()}catch{l.message=await e.text()}if(e.ok)r.value="✅ Project refreshed successfully!",j(),v();else if(l.errors){const a=Object.values(l.errors).flat().join(", ");r.value="❌ Validation Error: "+a}else r.value="❌ Error: "+(l.message||"Failed to refresh project")}catch(s){r.value="❌ Network error: "+s.message,console.error("Refresh error",s)}finally{n.value=!1}},V=async()=>{n.value=!0,r.value="";try{const s=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),e=await fetch("/api/user-project/template",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":s},body:JSON.stringify(i.value)});let l={};try{l=await e.json()}catch{l.message=await e.text()}if(e.ok)r.value="✅ New page created successfully from template!",_(),v(),l.project&&l.project.id&&(window.location.href=`/dashboard/project/${l.project.id}`);else if(l.errors){const a=Object.values(l.errors).flat().join(", ");r.value="❌ Validation Error: "+a}else r.value="❌ Error: "+(l.message||"Failed to create page from template")}catch(s){r.value="❌ Network error: "+s.message,console.error("Template creation error",s)}finally{n.value=!1}};return F(()=>{v()}),(s,e)=>(p(),O(B,null,{default:L(()=>[t("div",K,[t("div",X,[e[36]||(e[36]=t("div",{class:"mb-8"},[t("h1",{class:"text-3xl font-bold text-gray-900"}," Client Projects Management "),t("p",{class:"mt-2 text-gray-500"},[h(" Create and manage client projects. Each project will have its own page at "),t("code",null,"/user/{slug}"),h(". ")])],-1)),t("div",J,[t("div",z,[e[17]||(e[17]=t("div",{class:"bg-gradient-to-r from-blue-600 to-indigo-700 p-6 text-white"},[t("h2",{class:"text-2xl font-bold"}," Create New Project ")],-1)),t("form",{onSubmit:q(C,["prevent"]),class:"p-6 md:p-8"},[t("div",I,[t("div",null,[e[13]||(e[13]=t("label",{class:"mb-2 block text-sm font-semibold text-gray-700"}," Client Name * ",-1)),c(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>d.value.client_name=l),type:"text",placeholder:"Enter client name",class:"w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-3 text-gray-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-200",required:""},null,512),[[g,d.value.client_name]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"mb-2 block text-sm font-semibold text-gray-700"}," Project Title * ",-1)),c(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>d.value.title=l),type:"text",placeholder:"Enter project title",onInput:E,class:"w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-3 text-gray-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-200",required:""},null,544),[[g,d.value.title]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"mb-2 block text-sm font-semibold text-gray-700"}," URL Slug * ",-1)),c(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>d.value.slug=l),type:"text",placeholder:"Enter URL slug (e.g., client-project-name)",class:"w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-3 text-gray-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-200",required:""},null,512),[[g,d.value.slug]]),e[16]||(e[16]=t("p",{class:"mt-1 text-xs text-gray-500"}," This will be used in the URL: /user/{slug} ",-1))])]),t("div",G,[t("button",{type:"submit",disabled:n.value,class:"transform rounded-lg bg-blue-600 px-8 py-3 font-bold text-white shadow-lg transition hover:scale-105 hover:bg-blue-700 disabled:opacity-50"},m(n.value?"Creating...":"Create Project"),9,H)]),r.value?(p(),f("div",{key:0,class:$(["mt-4 text-center font-bold",r.value.includes("✅")?"text-green-600":"text-red-600"])},m(r.value),3)):w("",!0)],32)]),t("div",Q,[e[35]||(e[35]=t("div",{class:"bg-gradient-to-r from-green-600 to-emerald-700 p-6 text-white"},[t("h2",{class:"text-2xl font-bold"}," Existing Projects ")],-1)),t("div",W,[y.value?(p(),f("div",Y,[e[21]||(e[21]=t("h3",{class:"mb-3 font-bold text-gray-900"}," Edit Project ",-1)),t("div",Z,[t("div",null,[e[18]||(e[18]=t("label",{class:"mb-1 block text-sm font-medium text-gray-700"},"Client Name",-1)),c(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>u.value.client_name=l),type:"text",class:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 focus:ring-2 focus:ring-yellow-500 focus:outline-none"},null,512),[[g,u.value.client_name]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"mb-1 block text-sm font-medium text-gray-700"},"Project Title",-1)),c(t("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>u.value.title=l),type:"text",class:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 focus:ring-2 focus:ring-yellow-500 focus:outline-none"},null,512),[[g,u.value.title]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"mb-1 block text-sm font-medium text-gray-700"},"URL Slug",-1)),c(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>u.value.slug=l),type:"text",class:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 focus:ring-2 focus:ring-yellow-500 focus:outline-none"},null,512),[[g,u.value.slug]]),t("p",ee," Current URL: /user/"+m(u.value.slug),1)]),t("div",te,[t("button",{onClick:k,class:"rounded-md bg-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-400"}," Cancel "),t("button",{onClick:N,disabled:n.value,class:"rounded-md bg-yellow-500 px-4 py-2 text-sm font-medium text-white hover:bg-yellow-600 disabled:opacity-50"},m(n.value?"Updating...":"Update Project"),9,le)])])])):w("",!0),o.value.id?(p(),f("div",se,[e[26]||(e[26]=t("h3",{class:"mb-3 font-bold text-gray-900"}," Refresh Project Content ",-1)),e[27]||(e[27]=t("p",{class:"mb-4 text-sm text-gray-600"}," Update project details and optionally clear all existing content. ",-1)),t("div",re,[t("div",null,[e[22]||(e[22]=t("label",{class:"mb-1 block text-sm font-medium text-gray-700"},"Client Name",-1)),c(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>o.value.client_name=l),type:"text",class:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 focus:ring-2 focus:ring-blue-500 focus:outline-none"},null,512),[[g,o.value.client_name]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"mb-1 block text-sm font-medium text-gray-700"},"Project Title",-1)),c(t("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>o.value.title=l),type:"text",class:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 focus:ring-2 focus:ring-blue-500 focus:outline-none"},null,512),[[g,o.value.title]])]),t("div",null,[e[24]||(e[24]=t("label",{class:"mb-1 block text-sm font-medium text-gray-700"},"URL Slug",-1)),c(t("input",{"onUpdate:modelValue":e[8]||(e[8]=l=>o.value.slug=l),type:"text",class:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 focus:ring-2 focus:ring-blue-500 focus:outline-none"},null,512),[[g,o.value.slug]]),t("p",oe," Current URL: /user/"+m(o.value.slug),1)]),t("div",ae,[c(t("input",{"onUpdate:modelValue":e[9]||(e[9]=l=>o.value.reset_content=l),type:"checkbox",class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,512),[[M,o.value.reset_content]]),e[25]||(e[25]=t("label",{class:"ml-2 block text-sm text-gray-700"}," Clear all existing content ",-1))]),t("div",ne,[t("button",{onClick:j,class:"rounded-md bg-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-400"}," Cancel "),t("button",{onClick:S,disabled:n.value,class:"rounded-md bg-blue-500 px-4 py-2 text-sm font-medium text-white hover:bg-blue-600 disabled:opacity-50"},m(n.value?"Refreshing...":"Refresh Project"),9,ue)])])])):w("",!0),i.value.template_page_id?(p(),f("div",ie,[e[31]||(e[31]=t("h3",{class:"mb-3 font-bold text-gray-900"}," Create New Page from Template ",-1)),e[32]||(e[32]=t("p",{class:"mb-4 text-sm text-gray-600"}," Create a new page using the selected project as a template. ",-1)),t("div",de,[t("div",null,[e[28]||(e[28]=t("label",{class:"mb-1 block text-sm font-medium text-gray-700"},"Client Name *",-1)),c(t("input",{"onUpdate:modelValue":e[10]||(e[10]=l=>i.value.client_name=l),type:"text",class:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 focus:ring-2 focus:ring-green-500 focus:outline-none",placeholder:"Enter client name for new page",required:""},null,512),[[g,i.value.client_name]])]),t("div",null,[e[29]||(e[29]=t("label",{class:"mb-1 block text-sm font-medium text-gray-700"},"Project Title *",-1)),c(t("input",{"onUpdate:modelValue":e[11]||(e[11]=l=>i.value.title=l),type:"text",class:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 focus:ring-2 focus:ring-green-500 focus:outline-none",placeholder:"Enter title for new page",required:""},null,512),[[g,i.value.title]])]),t("div",null,[e[30]||(e[30]=t("label",{class:"mb-1 block text-sm font-medium text-gray-700"},"URL Slug *",-1)),c(t("input",{"onUpdate:modelValue":e[12]||(e[12]=l=>i.value.slug=l),type:"text",class:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 focus:ring-2 focus:ring-green-500 focus:outline-none",placeholder:"Enter unique slug for new page",required:""},null,512),[[g,i.value.slug]]),t("p",ce," New URL: /user/"+m(i.value.slug),1)]),t("div",ge,[t("button",{onClick:_,class:"rounded-md bg-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-400"}," Cancel "),t("button",{onClick:V,disabled:n.value,class:"rounded-md bg-green-500 px-4 py-2 text-sm font-medium text-white hover:bg-green-600 disabled:opacity-50"},m(n.value?"Creating...":"Create New Page"),9,me)])])])):w("",!0),x.value.length>0?(p(),f("div",pe,[(p(!0),f(A,null,D(x.value,l=>(p(),f("div",{key:l.id,class:"rounded-lg border border-gray-200 p-4"},[t("div",be,[t("div",null,[t("h3",fe,m(l.title),1),t("p",ve,m(l.client_name),1),t("p",xe,[e[33]||(e[33]=h(" URL: ",-1)),t("a",{href:`/user/${l.slug||"default"}`,class:"text-blue-600 hover:underline",target:"_blank"}," /user/"+m(l.slug||"default"),9,ye)])]),t("div",we,[t("span",he,m(l.files_count||0)+" files ",1),t("div",ke,[t("a",{href:`/user/${l.slug}`,target:"_blank",class:"text-sm text-green-600 hover:text-green-800"}," View Public ",8,je),t("a",{href:`/dashboard/project/${l.id}`,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Manage ",8,_e),t("button",{onClick:a=>U(l.id),class:"text-sm text-teal-600 hover:text-teal-800"}," Use as Template ",8,Ce),t("button",{onClick:a=>P(l),class:"text-sm text-blue-600 hover:text-blue-800"}," Refresh ",8,Ee),t("button",{onClick:a=>T(l),class:"text-sm text-purple-600 hover:text-purple-800"}," Edit ",8,Te),t("button",{onClick:a=>R(l.id),class:"text-sm text-red-600 hover:text-red-800"}," Delete ",8,Pe)])])])]))),128))])):(p(),f("div",Ue,[...e[34]||(e[34]=[t("p",null,"No projects found.",-1)])]))])])])])])]),_:1}))}};export{Fe as default};
